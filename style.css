/* =========================
   Theme Variables
   ========================= */
:root{
  --bg:#ffffff;
  --fg:#0f1419;
  --muted:#536471;
  --line:#eff3f4;
  --primary:#1d9bf0;
  --primary-ink:#fff;
  --card:#fff;
  --hover:#f7f9f9;
  --danger:#ef4444;
}
:root.dark{
  --bg:#000000;
  --fg:#e7e9ea;
  --muted:#8b98a5;
  --line:#2f3336;
  --primary:#1d9bf0;
  --primary-ink:#fff;
  --card:#0a0a0a;
  --hover:#111315;
}

/* =========================
   Reset / Base
   ========================= */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font:14px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",PingFang SC,Microsoft Yahei,Helvetica,sans-serif;
  background:var(--bg);
  color:var(--fg);
}

/* =========================
   App Layout
   ========================= */
.app{
  display:grid;
  grid-template-columns:260px minmax(0,680px) 360px;
  gap:0;
  max-width:1400px;
  margin:0 auto;
}

/* =========================
   Left Nav
   ========================= */
.left-nav{
  position:sticky; top:0;
  height:100vh;
  padding:16px 12px;
  border-right:1px solid var(--line);
}
.brand{ display:flex; align-items:center; gap:8px; padding:8px; border-radius:999px; width:max-content; }
.brand .logo{ width:28px; height:28px; fill:var(--primary); }
.brand h1{ font-size:20px; margin:0; }
.nav-items{ margin:12px 0 16px; display:flex; flex-direction:column; gap:4px; }
.nav-item{
  padding:12px 14px; border-radius:999px; cursor:pointer;
  display:flex; gap:10px; align-items:center;
}
.nav-item:hover{ background:var(--hover); }
.nav-item.is-active{ font-weight:700; }

.btn{ border:1px solid var(--line); background:var(--card); color:var(--fg); padding:8px 14px; border-radius:999px; cursor:pointer; }
.btn:hover{ background:var(--hover); }
.btn-primary{ background:var(--primary); color:var(--primary-ink); border-color:var(--primary); }
.btn-primary:hover{ filter:brightness(1.02); }
.btn-full{ width:100%; margin-top:10px; }

.icon-btn{ border:none; background:transparent; cursor:pointer; padding:6px; border-radius:8px; }
.icon-btn:hover{ background:var(--hover); }

.me-block{ margin-top:12px; padding:10px; border:1px solid var(--line); border-radius:16px; }
.me-block .small{ color:var(--muted); font-size:12px; }

/* =========================
   Main Column
   ========================= */
.main{ border-right:1px solid var(--line); min-height:100vh; }

/* Global top tabs bar (home/following) */
.topbar{
  position:sticky; top:0; z-index:3;
  background:var(--bg);
  border-bottom:1px solid var(--line);
  display:flex; align-items:center; justify-content:space-between;
  padding:8px 12px;
}
.tabs{ display:flex; gap:12px; }
.tab{
  background:transparent; border:none; padding:10px 8px; font-weight:600; cursor:pointer; color:var(--muted);
}
.tab.is-active{ color:var(--fg); border-bottom:3px solid var(--primary); }
.tabs.small .tab{ padding:8px 6px; }

/* Search */
.searchbar{
  display:flex; align-items:center; gap:6px;
  border:1px solid var(--line); padding:6px 10px; border-radius:20px; min-width:220px;
}
.searchbar input{ border:none; outline:none; background:transparent; color:var(--fg); width:180px; }

/* Composer (home) */
.composer{ display:flex; gap:10px; padding:12px; border-bottom:1px solid var(--line); }
.composer .avatar{ width:40px; height:40px; border-radius:50%; background:#ddd; }
.composer-body{ flex:1; }
.composer textarea{
  width:100%; resize:vertical; border:none; outline:none; background:transparent; color:var(--fg);
  font-size:16px;
}
.composer-actions{ display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap; }
.preview{ display:flex; gap:6px; flex-wrap:wrap; }
.preview img{ width:96px; height:96px; object-fit:cover; border-radius:12px; border:1px solid var(--line); }

/* Feed & Card */
.feed{ display:flex; flex-direction:column; }
.card{
  display:flex; gap:10px; padding:12px; border-bottom:1px solid var(--line);
  transition:background .15s ease;
}
.card .avatar{ width:42px; height:42px; border-radius:50%; background:#ddd; }
.card .content{ flex:1; min-width:0; }
.card .head{ display:flex; gap:8px; align-items:center; }
.card .name{ font-weight:700; }
.card .meta{ color:var(--muted); font-size:12px; }
.card .text{ margin:6px 0 8px; white-space:pre-wrap; word-break:break-word; }
.card .pics{ display:flex; gap:6px; flex-wrap:wrap; }
.card .pics img{ border-radius:12px; border:1px solid var(--line); width:100%; max-width:260px; height:auto; }
.card .actions{ display:flex; gap:16px; align-items:center; color:var(--muted); margin-top:8px; pointer-events:none; }
.card .actions .action{ display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px 8px; border-radius:999px; pointer-events:auto; }
.card .actions .action:hover{ background:var(--hover); }
.card.clickable{ cursor:pointer; }
.card.clickable:hover{ background:var(--hover); }
.action.liked{ color:var(--primary); }

.empty,.loading{ text-align:center; padding:24px; color:var(--muted); }

/* =========================
   Right Rail
   ========================= */
.right-rail{ padding:16px; }
.panel{ border:1px solid var(--line); border-radius:16px; padding:12px; margin-bottom:12px; background:var(--card); }
.panel h3{ margin:4px 0 8px; }
.suggestions .who{ display:flex; align-items:center; gap:8px; padding:8px; border-radius:12px; }
.suggestions .who:hover{ background:var(--hover); }
.suggestions .who .avatar{ width:36px; height:36px; border-radius:50%; background:#ddd; }
.suggestions .who .meta{ font-size:12px; color:var(--muted); }

/* =========================
   Modals (auth / reply)
   ========================= */
.modal{ border:none; background:rgba(0,0,0,.4); }
.modal::backdrop{
  background: rgba(0,0,0,.50);
  backdrop-filter: blur(2px) saturate(110%);
}
.modal-card{ width:min(680px,92vw); background:var(--bg); color:var(--fg); border:1px solid var(--line); border-radius:16px; padding:12px; position:relative; }
.modal-card .close{ position:absolute; top:8px; right:8px; }

.auth-card{ width:min(520px,92vw); background:var(--bg); color:var(--fg); border:1px solid var(--line); border-radius:16px; padding:16px; position:relative; }
.auth-card label{ display:block; margin:8px 0 4px; color:var(--muted); }
.auth-card input{ width:100%; border:1px solid var(--line); border-radius:10px; padding:10px; background:transparent; color:var(--fg); }
.auth-card .row{ display:flex; gap:8px; margin-top:10px; }
.pane{ margin-top:6px; }

/* Reply modal quoted block */
.reply-card .close{ position:absolute; top:8px; right:8px; }
.quoted{ border-left:3px solid var(--line); padding-left:12px; margin:6px 0 8px; }
.quoted .head{ font-weight:600; font-size:15px; margin-bottom:4px; }
.quoted .text{ white-space:pre-wrap; line-height:1.5; }

/* =========================
   Thread Page (single post)
   ========================= */
/* top bar of post page */
.post-topbar{
  height:52px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; border-bottom:1px solid var(--line); background:var(--bg);
}
.post-topbar .title{ font-weight:800; font-size:18px; }
.btn-ghost{
  border:1px solid var(--line); background:transparent; color:var(--fg);
  padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:600;
}
.btn-ghost:hover{ background:var(--hover); }

/* grid rows with avatar rail (56px) */
.post-thread{ background:var(--bg); }
.post-thread .row{
  display:grid; grid-template-columns:56px 1fr; column-gap:12px; padding:12px 16px;
}
.post-thread .row + .row{ border-top:1px solid var(--line); }
.post-thread .rail{ width:40px; height:40px; border-radius:50%; background:#ddd; object-fit:cover; grid-column:1; }
.post-thread .body{ grid-column:2; }

/* original post block */
.post-thread .detail .head{ font-weight:700; font-size:15px; margin-bottom:4px; }
.post-thread .detail .text{ font-size:17px; line-height:1.55; margin:8px 0 6px; }
.post-thread .detail .body{ position:relative; }
.post-thread .detail .body::before{
  content:""; position:absolute; left:-16px; top:44px; bottom:10px; width:2px; background:var(--line);
}
.post-thread .pics img{ max-width:100%; border-radius:12px; margin-top:10px; }
.post-thread .actions{ display:flex; gap:22px; margin-top:10px; color:var(--muted); }
.post-thread .action{ cursor:pointer; display:inline-flex; align-items:center; gap:6px; }
.post-thread .action.like.liked{ color:#e0245e; }

/* timestamp row under the post */
.post-thread .meta-row{
  display:grid; grid-template-columns:56px 1fr; column-gap:12px;
  padding:12px 16px; border-top:1px solid var(--line); border-bottom:1px solid var(--line);
}
.post-thread .timestamp{ color:var(--muted); font-size:14px; }

/* inline reply composer (bottom) */
.post-thread .row.composer{ align-items:center; }              /* avatar/grid items vertically centered */
.reply-inline{ display:flex; align-items:center; gap:12px; }
.reply-inline .avatar{
  width:44px; height:44px; border-radius:50%; background:#ddd; flex-shrink:0;
}

.reply-inline .btn{
  display:inline-flex; align-items:center; justify-content:center;
  height:40px; padding:0 14px; border-radius:999px; font-weight:600;
}

/* comments list */
.post-thread .comment .head{ font-weight:600; font-size:15px; margin-bottom:2px; }
.post-thread .comment .text{ font-size:15px; line-height:1.5; }

/* =========================
   Toast
   ========================= */
.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom:24px; background:var(--fg); color:var(--bg);
  padding:10px 14px; border-radius:12px; font-weight:600;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

/* =========================
   Responsive
   ========================= */
@media (max-width:1200px){
  .right-rail{ display:none; }
  .app{ grid-template-columns:72px minmax(0,680px); }
  .brand h1{ display:none; }
  .nav-item span{ display:none; }
  .btn-full{ display:none; }
  .me-block{ display:none; }
}
@media (max-width:680px){
  .left-nav{ display:none; }
  .app{ grid-template-columns:1fr; }
  .main{ border-right:none; }
  .right-rail{ display:none; }
  .topbar{ position:sticky; top:0; }
}

/* ===== 推特式无边框编辑框（回复栏） ===== */

/* 行和容器允许随 textarea 一起长高，不隐藏溢出 */
.post-thread .row,
.post-thread .row .body,
.reply-inline,
.reply-editor{
  height: auto;
  overflow: visible;
}

/* 回复行顶部对齐，避免“居中”导致可视区域被吃掉 */
.post-thread .row.composer{ align-items: flex-start; }
.reply-inline{ align-items: flex-start; }

/* 回复栏布局（头像 + 编辑区） */
.reply-inline{
  display: flex;
  gap: 12px;
}
.reply-inline .avatar{
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: #ddd;
  flex-shrink: 0;
}

/* 只保留这一套：textarea 无边框，由 JS 控高，禁用内部滚动 */
.reply-editor{
  flex: 1;
  display: flex;
  flex-direction: column;
}
.reply-editor textarea{
  display: block;
  width: 100%;
  border: none;
  outline: none;
  background: transparent;
  color: var(--fg);
  box-sizing: border-box;

  padding: 12px 0;
  font-size: 16px;
  line-height: 1.5;
  resize: none;

  overflow-y: hidden;  /* 不出现内部滚动条 */
  height: auto;       /* 由 JS 设置高度 */
  min-height: 28px;
  transition: height .15s ease, padding .15s ease;
}

/* 聚焦时轻微展开（不妨碍 JS 自增高） */
.reply-editor:focus-within textarea{
  min-height: 64px;
  padding: 14px 0;
}

/* 占位样式（更像推特） */
.reply-editor textarea::placeholder{
  color: var(--muted);
  opacity: .75;
  font-weight: 600;
  font-size: 16px;
  text-align: left;
}

/* 工具栏（计数 + 按钮）与 Upsell */
.reply-tools{
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  padding-top: 8px;
}
.char-counter{
  min-width: 28px;
  height: 28px;
  padding: 0 8px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f0f3f4;
  color: #606a73;
  font-weight: 700;
  font-size: 13px;
}
:root.dark .char-counter{ background:#1b1e20; color:#8b98a5; }
.char-counter.over{ background:#ffe8e8; color:#c81e1e; }
:root.dark .char-counter.over{ background:#3a0d0d; color:#ff7373; }

.upsell{
  display: none;
  margin-top: 8px;
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 10px 12px;
  color: var(--muted);
  font-size: 14px;
}
.upsell.show{ display: block; }

/* 左侧竖线只用于正文，不拦截事件，也不参与叠层遮挡 */
.post-thread .detail .body{ position: relative; }
.post-thread .detail .body::before{
  content: "";
  position: absolute;
  left: -16px;
  top: 44px;
  bottom: 10px;
  width: 2px;
  background: var(--line);
  pointer-events: none; /* 不拦截鼠标/输入事件 */
}
/* 确保回复行不受竖线影响 */
.post-thread .row.composer .body::before{ content: none; }

/* ===== Reply Modal: softer shadow + layout ===== */
.modal{
  border: none;
  background: rgba(0,0,0,.50);
  backdrop-filter: blur(2px) saturate(110%);
}

/* 仅用 backdrop 做遮罩；dialog 本体透明 */
.modal{
  border: none;
  background: transparent; /* ← 关键：不要给 dialog 自己上黑底 */
  padding: 0;              /* 避免内容四周再留黑边距 */
}

/* 更柔和的遮罩 */
.modal::backdrop{
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(2px) saturate(110%);
}


/* Reply 弹窗卡片：移除硬边框，改成多层软阴影 */
.reply-card{
  width: min(680px, 96vw);
  background: var(--bg);
  color: var(--fg);

  /* 去掉硬边框，改为极浅的发光边缘 */
  border: none;
  outline: 1px solid rgba(0,0,0,.06);        /* 亮色主题下轻微描边 */
}
:root.dark .reply-card{
  outline: 1px solid rgba(255,255,255,.06);  /* 暗色主题下轻微描边 */
}

.reply-card{
  border: none;
  outline: none;
  border-radius: 16px;
  background: var(--bg);
  color: var(--fg);
}

/* 两行线程：左 56px 头像轨道，右正文；行距 12px */
.reply-thread{
  display:grid;
  grid-template-columns:56px 1fr;
  row-gap:12px; column-gap:12px;
  padding:16px;
}
.reply-thread .rail{
  grid-column:1; position:relative;
  display:flex; justify-content:center;
}
.reply-thread .rail .avatar{
  width:40px; height:40px; border-radius:50%; background:#ddd; object-fit:cover;
}

/* 连接竖线：从第1行头像底部连到第2行头像顶部 */
.reply-thread .rail:first-of-type::after{
  content:""; position:absolute; left:50%;
  width:2px; transform:translateX(-50%);
  top:48px;                      /* 40px头像 + 8px间距 */
  bottom:-12px;                  /* 延伸到下一行顶部上方一点 */
  background:var(--line);
  pointer-events:none;
}
/* 最后一行不再延伸线条 */
.reply-thread .rail.me::after{ display:none; }

.reply-thread .body{ grid-column:2; }

/* 上方原帖文字块更像推特小摘要 */
.quoted-detail .head{ font-weight:700; font-size:15px; margin-bottom:4px; }
.quoted-detail .text{
  font-size:16px; line-height:1.5; margin-top:6px; white-space:pre-wrap;
}

/* 无边框编辑器（沿用你在单帖页的样式） */
.reply-inline{ display:flex; align-items:flex-start; gap:12px; }
.reply-editor{ flex:1; display:flex; flex-direction:column; }
.reply-editor textarea{
  display:block; width:100%;
  border:none; outline:none; background:transparent; color:var(--fg);
  box-sizing:border-box;
  padding:12px 0;
  font-size:16px; line-height:1.5;
  resize:none;
  overflow-y:hidden;   /* 禁止内部滚动，交给 JS 调整 height */
  height:auto; min-height:28px;
  transition:height .15s ease, padding .15s ease;
}
.reply-editor textarea::placeholder{
  color:var(--muted); opacity:.75; font-weight:600; font-size:16px; text-align:left;
}
.reply-editor:focus-within textarea{
  min-height:64px; padding:14px 0;  /* 聚焦轻微展开 */
}

.reply-tools{
  display:flex; align-items:center; justify-content:flex-end;
  gap:8px; padding-top:8px;
}
.char-counter{
  min-width:28px; height:28px; padding:0 8px;
  border-radius:999px; display:flex; align-items:center; justify-content:center;
  background:#f0f3f4; color:#606a73; font-weight:700; font-size:13px;
}
:root.dark .char-counter{ background:#1b1e20; color:#8b98a5; }
.char-counter.over{ background:#ffe8e8; color:#c81e1e; }
:root.dark .char-counter.over{ background:#3a0d0d; color:#ff7373; }

.upsell{
  display:none; margin-top:8px; border:1px solid var(--line);
  border-radius:12px; padding:10px 12px; color:var(--muted); font-size:14px;
}
.upsell.show{ display:block; }

.modal::backdrop{
  background: rgba(0,0,0,.50);
  backdrop-filter: blur(2px) saturate(110%);
}

/* ❗把旧的 .modal-card 的边框去掉 —— 防止任何弹窗出现硬边 */
.modal-card{
  width:min(680px,92vw);
  background:var(--bg);
  color:var(--fg);
  border:none;             /* 原来是 1px 实线，去掉 */
  border-radius:16px;
  padding:12px;
  position:relative;
  box-shadow:
    0 32px 96px -12px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0px rgba(0,0,0,.15);
}

/* Reply 弹窗卡片 —— 不要 outline，就用软阴影 */
.reply-card{
  width:min(680px,96vw);
  background:var(--bg);
  color:var(--fg);
  border:none;
  outline:none;            /* ← 去掉你先前加的细描边 */
  border-radius:16px;
  padding:0;
  position:relative;
  box-shadow:
    0 32px 96px -12px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0px rgba(0,0,0,.15);
}
:root.dark .reply-card{ outline:none; }

/* 关闭按钮位置（保持） */
.reply-card .close{ position:absolute; top:10px; right:10px; }

/* 彻底覆盖 <dialog> 自带的边框/阴影 */
dialog {
  border: none;          /* 去掉黑边 */
  padding: 0;            /* 不要额外留白 */
  background: transparent; /* 背景透明，让 backdrop 生效 */
  box-shadow: none;      /* 去掉默认的四角阴影 */
}

/* 彻底抹掉 <dialog> 的默认外观（黑角、描边、阴影） */
dialog,
.modal {
  border: 0 !important;
  outline: none !important;
  background: transparent !important;
  box-shadow: none !important;
  padding: 0 !important;
  border-radius: 0 !important;   /* 不要让 dialog 自己有圆角 */
}
dialog:focus,
dialog:focus-visible {
  outline: none !important;       /* 某些浏览器会给 focus 画外轮廓 */
}

/* 只让内部卡片负责圆角 + 阴影；裁掉内部内容避免锯齿叠影 */
.reply-card {
  border: none;
  outline: none;
  border-radius: 16px;
  background: var(--bg);
  color: var(--fg);
  padding: 0;
  position: relative;
  overflow: clip; /* 或 overflow: hidden; 防止内容/阴影在圆角处溢出产生直角感 */
  box-shadow:
    0 32px 96px -12px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0px rgba(0,0,0,.15);
}

/* 遮罩层只放在 backdrop 上 */
.modal::backdrop {
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(2px) saturate(110%);
}
