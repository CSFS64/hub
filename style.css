/* =========================
   Theme Variables
   ========================= */
:root{
  --bg:#ffffff;
  --fg:#0f1419;
  --muted:#536471;
  --line:#eff3f4;
  --primary:#1d9bf0;
  --primary-ink:#fff;
  --card:#fff;
  --hover:#f7f9f9;
  --danger:#ef4444;
}
:root.dark{
  --bg:#000000;
  --fg:#e7e9ea;
  --muted:#8b98a5;
  --line:#2f3336;
  --primary:#1d9bf0;
  --primary-ink:#fff;
  --card:#0a0a0a;
  --hover:#111315;
}

/* =========================
   Reset / Base
   ========================= */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font:14px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",PingFang SC,Microsoft Yahei,Helvetica,sans-serif;
  background:var(--bg);
  color:var(--fg);
}

/* =========================
   App Layout
   ========================= */
.app{
  display:grid;
  grid-template-columns:260px minmax(0,680px) 360px;
  gap:0;
  max-width:1400px;
  margin:0 auto;
}

/* =========================
   Left Nav
   ========================= */
.left-nav{
  position:sticky; top:0;
  height:100vh;
  padding:16px 12px;
  border-right:1px solid var(--line);
}
.brand{ display:flex; align-items:center; gap:8px; padding:8px; border-radius:999px; width:max-content; }
.brand .logo{ width:28px; height:28px; fill:var(--primary); }
.brand h1{ font-size:20px; margin:0; }
.nav-items{ margin:12px 0 16px; display:flex; flex-direction:column; gap:4px; }
.nav-item{
  padding:12px 14px; border-radius:999px; cursor:pointer;
  display:flex; gap:10px; align-items:center;
}
.nav-item:hover{ background:var(--hover); }
.nav-item.is-active{ font-weight:700; }

.btn{ border:1px solid var(--line); background:var(--card); color:var(--fg); padding:8px 14px; border-radius:999px; cursor:pointer; }
.btn:hover{ background:var(--hover); }
.btn-primary{ background:var(--primary); color:var(--primary-ink); border-color:var(--primary); }
.btn-primary:hover{ filter:brightness(1.02); }
.btn-full{ width:100%; margin-top:10px; }

.icon-btn{ border:none; background:transparent; cursor:pointer; padding:6px; border-radius:8px; }
.icon-btn:hover{ background:var(--hover); }

.me-block{ margin-top:12px; padding:10px; border:1px solid var(--line); border-radius:16px; }
.me-block .small{ color:var(--muted); font-size:12px; }

/* =========================
   Main Column
   ========================= */
.main{ border-right:1px solid var(--line); min-height:100vh; }

/* Global top tabs bar (home/following) */
.topbar{
  position:sticky; top:0; z-index:3;
  background:var(--bg);
  border-bottom:1px solid var(--line);
  display:flex; align-items:center; justify-content:space-between;
  padding:8px 12px;
}
.tabs{ display:flex; gap:12px; }
.tab{
  background:transparent; border:none; padding:10px 8px; font-weight:600; cursor:pointer; color:var(--muted);
}
.tab.is-active{ color:var(--fg); border-bottom:3px solid var(--primary); }
.tabs.small .tab{ padding:8px 6px; }

/* Search */
.searchbar{
  display:flex; align-items:center; gap:6px;
  border:1px solid var(--line); padding:6px 10px; border-radius:20px; min-width:220px;
}
.searchbar input{ border:none; outline:none; background:transparent; color:var(--fg); width:180px; }

/* Composer (home) */
.composer{ display:flex; gap:10px; padding:12px; border-bottom:1px solid var(--line); }
.composer .avatar{ width:40px; height:40px; border-radius:50%; background:#ddd; }
.composer-body{ flex:1; }
.composer textarea{
  width:100%; resize:vertical; border:none; outline:none; background:transparent; color:var(--fg);
  font-size:16px;
}
.composer-actions{ display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap; }
.preview{ display:flex; gap:6px; flex-wrap:wrap; }
.preview img{ width:96px; height:96px; object-fit:cover; border-radius:12px; border:1px solid var(--line); }

/* Feed & Card */
.feed{ display:flex; flex-direction:column; }
.card{
  display:flex; gap:10px; padding:12px; border-bottom:1px solid var(--line);
  transition:background .15s ease;
}
.card .avatar{ width:42px; height:42px; border-radius:50%; background:#ddd; }
.card .content{ flex:1; min-width:0; }
.card .head{ display:flex; gap:8px; align-items:center; }
.card .name{ font-weight:700; }
.card .meta{ color:var(--muted); font-size:12px; }
.card .text{ margin:6px 0 8px; white-space:pre-wrap; word-break:break-word; }
.card .pics{ display:flex; gap:6px; flex-wrap:wrap; }
.card .pics img{ border-radius:12px; border:1px solid var(--line); width:100%; max-width:260px; height:auto; }
.card .actions{ display:flex; gap:16px; align-items:center; color:var(--muted); margin-top:8px; pointer-events:none; }
.card .actions .action{ display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px 8px; border-radius:999px; pointer-events:auto; }
.card .actions .action:hover{ background:var(--hover); }
.card.clickable{ cursor:pointer; }
.card.clickable:hover{ background:var(--hover); }
.action.liked{ color:var(--primary); }

.empty,.loading{ text-align:center; padding:24px; color:var(--muted); }

/* =========================
   Right Rail
   ========================= */
.right-rail{ padding:16px; }
.panel{ border:1px solid var(--line); border-radius:16px; padding:12px; margin-bottom:12px; background:var(--card); }
.panel h3{ margin:4px 0 8px; }
.suggestions .who{ display:flex; align-items:center; gap:8px; padding:8px; border-radius:12px; }
.suggestions .who:hover{ background:var(--hover); }
.suggestions .who .avatar{ width:36px; height:36px; border-radius:50%; background:#ddd; }
.suggestions .who .meta{ font-size:12px; color:var(--muted); }

/* =========================
   Modals (auth / reply)
   ========================= */
.modal{ border:none; background:rgba(0,0,0,.4); }
.modal::backdrop{ background: rgba(0,0,0,.50); }

.modal-card{
  width:min(680px,92vw);
  background:var(--bg);
  color:var(--fg);
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px;
  position:relative;
}
.modal-card .close{ position:absolute; top:8px; right:8px; }

.auth-card{
  width:min(520px,92vw);
  background:var(--bg);
  color:var(--fg);
  border:1px solid var(--line);
  border-radius:16px;
  padding:16px;
  position:relative;
}
.auth-card label{ display:block; margin:8px 0 4px; color:var(--muted); }
.auth-card input{
  width:100%;
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  background:transparent;
  color:var(--fg);
}
.auth-card .row{ display:flex; gap:8px; margin-top:10px; }
.pane{ margin-top:6px; }

/* Reply modal quoted block */
.reply-card .close{ position:absolute; top:8px; right:8px; }

/* =========================
   Thread Page (single post)
   ========================= */
.post-topbar{
  height:52px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; border-bottom:1px solid var(--line); background:var(--bg);
}
.post-topbar .title{ font-weight:800; font-size:18px; }
.btn-ghost{
  border:1px solid var(--line); background:transparent; color:var(--fg);
  padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:600;
}
.btn-ghost:hover{ background:var(--hover); }

/* grid rows with avatar rail (56px) */
.post-thread{ background:var(--bg); }
.post-thread .row{
  display:grid; grid-template-columns:56px 1fr; column-gap:12px; padding:12px 16px;
}
.post-thread .row + .row{ border-top:1px solid var(--line); }
.post-thread .rail{ width:40px; height:40px; border-radius:50%; background:#ddd; object-fit:cover; grid-column:1; }
.post-thread .body{ grid-column:2; }

/* original post block */
.post-thread .detail .head{ font-weight:700; font-size:15px; margin-bottom:4px; }
.post-thread .detail .text{ font-size:17px; line-height:1.55; margin:8px 0 6px; }
.post-thread .detail .body{ position:relative; }
.post-thread .detail .body::before{
  content:""; position:absolute; left:-16px; top:44px; bottom:10px; width:2px; background:var(--line);
}
.post-thread .pics img{ max-width:100%; border-radius:12px; margin-top:10px; }
.post-thread .actions{ display:flex; gap:22px; margin-top:10px; color:var(--muted); }
.post-thread .action{ cursor:pointer; display:inline-flex; align-items:center; gap:6px; }
.post-thread .action.like.liked{ color:#e0245e; }

/* timestamp row under the post */
.post-thread .meta-row{
  display:grid; grid-template-columns:56px 1fr; column-gap:12px;
  padding:12px 16px; border-top:1px solid var(--line); border-bottom:1px solid var(--line);
}
.post-thread .timestamp{ color:var(--muted); font-size:14px; }

/* =========================
   Inline reply composer (bottom)
   ========================= */

/* 允许容器随 textarea 一起长高，不裁切；顶对齐从上往下增长 */
.post-thread .row,
.post-thread .row .body,
.reply-inline,
.reply-editor{
  height: auto;
  overflow: visible;
}
.post-thread .row.composer{ align-items: flex-start; }

/* 左侧头像 + 右侧编辑区 */
.reply-inline{
  display:flex;
  gap:12px;
  align-items:flex-start;           /* 顶对齐，整体从上往下长高 */
}
.reply-inline .avatar{
  width:44px; height:44px; border-radius:50%;
  background:#ddd; flex-shrink:0;
  align-self:flex-start;           /* 头像固定在顶部，不随多行居中 */
}

/* 编辑区布局 */
.reply-editor{ flex:1; display:flex; flex-direction:column; }

/* 无边框 textarea，由 JS 控高 */
.reply-editor textarea{
  display:block; width:100%;
  border:none; outline:none; background:transparent; color:var(--fg);
  box-sizing:border-box;
  font-size:16px; line-height:1.5;
  padding:12px 0;
  resize:none;
  overflow-y:hidden;
  height:auto; min-height:28px;
  transition:height .15s ease, padding .15s ease;
}
.reply-editor textarea::placeholder{
  color:var(--muted); opacity:.75; font-weight:600; font-size:16px; text-align:left;
}
.reply-editor:focus-within textarea{
  min-height:64px; padding:14px 0;  /* 这段保留用于其他页面的编辑区 */
}

/* —— 针对帖子页回复框：首行高度=头像高度，初始中线对齐；聚焦不跳 —— */
#commentTextPage{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  font-size: 20px;                 /* 推特风：15/20 */
  line-height: 20px;
  padding: 12px 0;                 /* 12 + 20 + 12 = 44 */
  min-height: 44px;                /* 首行总高度与头像一致 */
  border: none; outline:none; background:transparent;
  color: var(--fg); resize:none; width:100%; box-sizing:border-box;
}
#commentTextPage::placeholder{
  font: inherit;                    /* 继承度量，避免下沉 */
  line-height: inherit;
  color: rgba(83,100,113,.9);
  font-weight: 500;
}
/* 聚焦时保持同一盒模型，防止“轻微下跳” */
.reply-editor:focus-within #commentTextPage{
  min-height: 44px;
  padding: 12px 0;
}

/* 工具栏（计数 + 按钮） */
.reply-inline .btn{
  display:inline-flex; align-items:center; justify-content:center;
  height:40px; padding:0 14px; border-radius:999px; font-weight:600;
}
.reply-tools{
  display:flex; align-items:center; justify-content:flex-end;
  gap:8px; padding-top:8px;
}
.char-counter{
  min-width:28px; height:28px; padding:0 8px; border-radius:999px;
  display:flex; align-items:center; justify-content:center;
  background:#f0f3f4; color:#606a73; font-weight:700; font-size:13px;
}
:root.dark .char-counter{ background:#1b1e20; color:#8b98a5; }
.char-counter.over{ background:#ffe8e8; color:#c81e1e; }
:root.dark .char-counter.over{ background:#3a0d0d; color:#ff7373; }

/* =========================
   Toast
   ========================= */
.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom:24px; background:var(--fg); color:var(--bg);
  padding:10px 14px; border-radius:12px; font-weight:600;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

/* =========================
   Responsive
   ========================= */
@media (max-width:1200px){
  .right-rail{ display:none; }
  .app{ grid-template-columns:72px minmax(0,680px); }
  .brand h1{ display:none; }
  .nav-item span{ display:none; }
  .btn-full{ display:none; }
  .me-block{ display:none; }
}
@media (max-width:680px){
  .left-nav{ display:none; }
  .app{ grid-template-columns:1fr; }
  .main{ border-right:none; }
  .right-rail{ display:none; }
  .topbar{ position:sticky; top:0; }
}

/* ===== Reply Modal: softer shadow + layout ===== */
.modal{ border:none; background: rgba(0,0,0,.50); }
.modal{ border:none; background: transparent; padding:0; }
.modal::backdrop{ background: rgba(0,0,0,.35); }

.reply-card{
  width:min(680px,96vw);
  background:var(--bg);
  color:var(--fg);
  border:none; outline:none; border-radius:16px; padding:0; position:relative;
  box-shadow:
    0 32px 96px -12px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0px rgba(0,0,0,.15);
}
:root.dark .reply-card{ outline:none; }
.reply-card .close{ position:absolute; top:10px; right:10px; }

dialog,
dialog:focus,
dialog:focus-visible,
.reply-card:focus,
.reply-card:focus-visible {
  outline: none !important;
  box-shadow: none;
}
dialog.modal {
  background: transparent !important;
  border: none !important;
  padding: 0;
  box-shadow: none !important;
}
.reply-card {
  border: none;
  outline: none;
  border-radius: 16px;
  background: var(--bg);
  color: var(--fg);
  box-shadow:
    0 32px 96px -16px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0   rgba(0,0,0,.15);
}
dialog {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  background: transparent !important;
}

/* ===== Hotfix: 保证 Upsell 只在超字数时显示 ===== */
.upsell{ 
  display: none !important;
  visibility: hidden !important;
}
.upsell.show{
  display: block !important;
  visibility: visible !important;
}

/* ===== Hotfix: 弹窗回复采用“推特式两头像 + 连接灰线”布局，且不被裁切 ===== */
.reply-thread .rail{
  grid-column: 1 !important;
  position: relative !important;
  display: flex !important;
  justify-content: center !important;
}
.reply-thread .rail .avatar{
  width: 40px !important;
  height: 40px !important;
  border-radius: 50% !important;
  background: #ddd !important;
  object-fit: cover !important;
}

.reply-thread .rail.me::after{ display: none !important; }
.reply-thread .body{ grid-column: 2; }

/* ===== Hotfix: 输入框与头像精确对齐，并允许所在行随内容增高 ===== */
#replyText,
#commentTextPage{
  font-size: 15px !important;
  line-height: 20px !important;
  padding: 12px 0 !important;   /* 12 + 20 + 12 = 44，与 44px 头像中心线对齐 */
  min-height: 44px !important;
}
.reply-editor:focus-within textarea{
  min-height: 44px !important;
  padding: 12px 0 !important;   /* 聚焦不跳动 */
}
/* 容器允许增长，不裁切 */
.post-thread .row,
.post-thread .row .body,
.reply-inline,
.reply-editor{
  height: auto !important;
  overflow: visible !important;
}

/* ===== 输入区：和外层版式一致 ===== */
.reply-editor textarea{
  font-size: 15px; line-height: 1.6;     /* 与弹窗正文统一 */
  padding: 12px 0;                       /* 聚焦/未聚焦一致，避免跳动 */
  min-height: 44px;                      /* 首行总高与 44px 头像匹配 */
}
.reply-editor textarea::placeholder{
  color: rgba(83,100,113,.9);
  font-weight: 400;
}

/* ===== 保留原作者文本的段落/空行，且支持长链接换行 ===== */
#replyHost .text,
#replyHost,
.quoted-detail .text,
.post-thread .detail .text{
  white-space: pre-wrap !important;  /* 保留换行/空行 */
  word-break: break-word;            /* 不中断中文，长链接也能换行 */
  overflow-wrap: anywhere;           /* 超长单词/URL 强制换行 */
}

/* ① 引用区的“空行太大” → 只在弹窗的原帖文本里压一点垂直间距  */
.reply-card #replyHost,
.reply-card #replyHost .text,
.reply-card .quoted-detail .text{
  white-space: pre-wrap !important;   /* 继续保留换行/空行 */
  line-height: 1.5 !important;        /* 比之前略紧，空行也随之变小 */
  word-break: break-word;
  overflow-wrap: anywhere;
}

/* ③ 弹窗里的“Post your reply”输入框 */
#replyText{
  font-family: system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  font-size: 15px;
  line-height: 1.6;      /* 和页面评论栏一致 */
  padding: 12px 0;       /* 聚焦前后都一致，避免“往下跳” */
  min-height: 44px;      /* 与 44px 头像对齐 */
  border: none; outline: none; background: transparent;
  resize: none; width: 100%; box-sizing: border-box;
}
#replyText::placeholder{
  color: rgba(83,100,113,.9);
  font-weight: 400;
}

/* ===== 让昵称行紧贴头像顶部 —— 切掉所有可能的顶边距/内边距 ===== */
.reply-card .reply-thread .row:first-child .body{
  padding-top: 0 !important;
  margin-top: 0 !important;
}
.reply-card #replyHost{
  margin-top: 0 !important;
  padding-top: 0 !important;
}
.reply-card #replyHost > *:first-child{
  margin-top: 0 !important;
}

/* 确保正文紧跟在作者行之后，不留大空隙 */
.reply-card #replyHost .text {
  line-height: 1.5 !important;
  margin-top: 2px !important;
}

/* ===== Reply 弹窗（推特风格） ===== */
.reply-card {
  width: min(600px, 96vw);
  border-radius: 16px;
  background: var(--bg);
  color: var(--fg);
  box-shadow:
    0 32px 96px -16px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0   rgba(0,0,0,.15);
  font-family: system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  font-size: 15px;
  line-height: 1.6;
  overflow: visible;
  padding: 0;
  position: relative;
}
.reply-card .close{ position:absolute; top:12px; right:12px; }

/* 两头像 + 灰线布局 */
.reply-thread {
  display: grid;
  grid-template-columns: 56px 1fr;
  column-gap: 12px;
  row-gap: 12px;
  padding: 20px;
}
.reply-thread .rail {
  grid-column: 1;
  position: relative;
  display: flex;
  justify-content: center;
}
.reply-thread .rail .avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #ddd;
  object-fit: cover;
}
.reply-thread .rail:first-of-type::after {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: 2px;
  top: 48px;   /* 40px头像 + 8px间距 */
  bottom: -12px;
  background: var(--line);
}
.reply-thread .rail.me::after { display: none; }
.reply-thread .body { grid-column: 2; }

/* 正文文本 */
.reply-card #replyHost .text {
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: anywhere;
  line-height: 1.5;
  margin-top: 2px;
}

/* 输入框（推特风） */
#replyText {
  font-family: inherit;
  font-size: 15px;
  line-height: 1.6;
  padding: 12px 0;
  min-height: 44px;
  border: none;
  outline: none;
  background: transparent;
  resize: none;
  width: 100%;
  box-sizing: border-box;
}
#replyText::placeholder {
  color: rgba(83,100,113,.9);
  font-weight: 400;
}

/* 工具栏（字数统计 + 按钮） */
.reply-tools {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 8px;
  padding: 12px 20px 16px;
}
.char-counter {
  min-width: 28px;
  height: 28px;
  padding: 0 8px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f0f3f4;
  color: #606a73;
  font-weight: 700;
  font-size: 13px;
}
:root.dark .char-counter{ background:#1b1e20; color:#8b98a5; }
.char-counter.over{ background:#ffe8e8; color:#c81e1e; }
:root.dark .char-counter.over{ background:#3a0d0d; color:#ff7373; }

.reply-card #replyHost .head {
  display: flex;
  align-items: flex-start !important;   /* 改成顶对齐 */
  gap: 6px;
  font-weight: 700;
  font-size: 15px;
  margin: 0 0 4px !important;
}
