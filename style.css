/* =========================
   Theme Variables
   ========================= */
:root{
  --bg:#ffffff;
  --fg:#0f1419;
  --muted:#536471;
  --line:#eff3f4;
  --primary:#1d9bf0;
  --primary-ink:#fff;
  --card:#fff;
  --hover:#f7f9f9;
  --danger:#ef4444;
}
:root.dark{
  --bg:#000000;
  --fg:#e7e9ea;
  --muted:#8b98a5;
  --line:#2f3336;
  --primary:#1d9bf0;
  --primary-ink:#fff;
  --card:#0a0a0a;
  --hover:#111315;
}

/* =========================
   Reset / Base
   ========================= */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font:14px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",PingFang SC,Microsoft Yahei,Helvetica,sans-serif;
  background:var(--bg);
  color:var(--fg);
}

/* =========================
   App Layout
   ========================= */
.app{
  display:grid;
  grid-template-columns:260px minmax(0,680px) 360px;
  gap:0;
  max-width:1400px;
  margin:0 auto;
}

/* =========================
   Left Nav
   ========================= */
.left-nav{
  position:sticky; top:0;
  height:100vh;
  padding:16px 12px;
  border-right:1px solid var(--line);
}
.brand{ display:flex; align-items:center; gap:8px; padding:8px; border-radius:999px; width:max-content; }
.brand .logo{ width:28px; height:28px; fill:var(--primary); }
.brand h1{ font-size:20px; margin:0; }
.nav-items{ margin:12px 0 16px; display:flex; flex-direction:column; gap:4px; }
.nav-item{
  padding:12px 14px; border-radius:999px; cursor:pointer;
  display:flex; gap:10px; align-items:center;
}
.nav-item:hover{ background:var(--hover); }
.nav-item.is-active{ font-weight:700; }

.btn{ border:1px solid var(--line); background:var(--card); color:var(--fg); padding:8px 14px; border-radius:999px; cursor:pointer; }
.btn:hover{ background:var(--hover); }
.btn-primary{ background:var(--primary); color:var(--primary-ink); border-color:var(--primary); }
.btn-primary:hover{ filter:brightness(1.02); }
.btn-full{ width:100%; margin-top:10px; }

.icon-btn{ border:none; background:transparent; cursor:pointer; padding:6px; border-radius:8px; }
.icon-btn:hover{ background:var(--hover); }

.me-block{ margin-top:12px; padding:10px; border:1px solid var(--line); border-radius:16px; }
.me-block .small{ color:var(--muted); font-size:12px; }

/* =========================
   Main Column
   ========================= */
.main{ border-right:1px solid var(--line); min-height:100vh; }

/* Global top tabs bar (home/following) */
.topbar{
  position:sticky; top:0; z-index:3;
  background:var(--bg);
  border-bottom:1px solid var(--line);
  display:flex; align-items:center; justify-content:space-between;
  padding:8px 12px;
}
.tabs{ display:flex; gap:12px; }
.tab{
  background:transparent; border:none; padding:10px 8px; font-weight:600; cursor:pointer; color:var(--muted);
}
.tab.is-active{ color:var(--fg); border-bottom:3px solid var(--primary); }
.tabs.small .tab{ padding:8px 6px; }

/* Search */
.searchbar{
  display:flex; align-items:center; gap:6px;
  border:1px solid var(--line); padding:6px 10px; border-radius:20px; min-width:220px;
}
.searchbar input{ border:none; outline:none; background:transparent; color:var(--fg); width:180px; }

/* Composer (home) */
.composer{ display:flex; gap:10px; padding:12px; border-bottom:1px solid var(--line); }
.composer .avatar{ width:40px; height:40px; border-radius:50%; background:#ddd; }
.composer-body{ flex:1; }
.composer textarea{
  width:100%; resize:vertical; border:none; outline:none; background:transparent; color:var(--fg);
  font-size:16px;
}
.composer-actions{ display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap; }
.preview{ display:flex; gap:6px; flex-wrap:wrap; }
.preview img{ width:96px; height:96px; object-fit:cover; border-radius:12px; border:1px solid var(--line); }

/* Feed & Card */
.feed{ display:flex; flex-direction:column; }
.card{
  display:flex; gap:10px; padding:12px; border-bottom:1px solid var(--line);
  transition:background .15s ease;
}
.card .avatar{ width:42px; height:42px; border-radius:50%; background:#ddd; }
.card .content{ flex:1; min-width:0; }
.card .head{ display:flex; gap:8px; align-items:center; }
.card .name{ font-weight:700; }
.card .meta{ color:var(--muted); font-size:12px; }
.card .text{ margin:6px 0 8px; white-space:pre-wrap; word-break:break-word; }
.card .pics{ display:flex; gap:6px; flex-wrap:wrap; }
.card .pics img{ border-radius:12px; border:1px solid var(--line); width:100%; max-width:260px; height:auto; }
.card .actions{ display:flex; gap:16px; align-items:center; color:var(--muted); margin-top:8px; pointer-events:none; }
.card .actions .action{ display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px 8px; border-radius:999px; pointer-events:auto; }
.card .actions .action:hover{ background:var(--hover); }
.card.clickable{ cursor:pointer; }
.card.clickable:hover{ background:var(--hover); }
.action.liked{ color:var(--primary); }

.empty,.loading{ text-align:center; padding:24px; color:var(--muted); }

/* 详情页/评论里的正文必须保留换行与空行 */
.post-thread .detail .text,
.post-thread .comment .text {
  white-space: pre-wrap;    /* 保留 \n 与空行 */
  word-break: break-word;   /* 不会把中文硬断 */
  overflow-wrap: anywhere;  /* 超长链接也能换行 */
}

/* =========================
   Right Rail
   ========================= */
.right-rail{ padding:16px; }
.panel{ border:1px solid var(--line); border-radius:16px; padding:12px; margin-bottom:12px; background:var(--card); }
.panel h3{ margin:4px 0 8px; }
.suggestions .who{ display:flex; align-items:center; gap:8px; padding:8px; border-radius:12px; }
.suggestions .who:hover{ background:var(--hover); }
.suggestions .who .avatar{ width:36px; height:36px; border-radius:50%; background:#ddd; }
.suggestions .who .meta{ font-size:12px; color:var(--muted); }

/* =========================
   Modals (auth / reply)
   ========================= */
.modal{ border:none; background:rgba(0,0,0,.4); }
.modal::backdrop{ background: rgba(0,0,0,.50); }

.modal-card{
  width:min(680px,92vw);
  background:var(--bg);
  color:var(--fg);
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px;
  position:relative;
}
.modal-card .close{ position:absolute; top:8px; right:8px; }

.auth-card{
  width:min(520px,92vw);
  background:var(--bg);
  color:var(--fg);
  border:1px solid var(--line);
  border-radius:16px;
  padding:16px;
  position:relative;
}
.auth-card label{ display:block; margin:8px 0 4px; color:var(--muted); }
.auth-card input{
  width:100%;
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  background:transparent;
  color:var(--fg);
}
.auth-card .row{ display:flex; gap:8px; margin-top:10px; }
.pane{ margin-top:6px; }

/* Reply modal quoted block */
.reply-card .close{ position:absolute; top:8px; right:8px; }

/* =========================
   Thread Page (single post)
   ========================= */
.post-topbar{
  height:52px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; border-bottom:1px solid var(--line); background:var(--bg);
}
.post-topbar .title{ font-weight:800; font-size:18px; }
.btn-ghost{
  border:1px solid var(--line); background:transparent; color:var(--fg);
  padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:600;
}
.btn-ghost:hover{ background:var(--hover); }

/* grid rows with avatar rail (56px) */
.post-thread{ background:var(--bg); }
.post-thread .row{
  display:grid; grid-template-columns:56px 1fr; column-gap:12px; padding:12px 16px;
}
.post-thread .row + .row{ border-top:1px solid var(--line); }
.post-thread .rail{ width:40px; height:40px; border-radius:50%; background:#ddd; object-fit:cover; grid-column:1; }
.post-thread .body{ grid-column:2; }

/* original post block */
.post-thread .detail .head{ font-weight:700; font-size:15px; margin-bottom:4px; }
.post-thread .detail .text{ font-size:17px; line-height:1.55; margin:8px 0 6px; }
.post-thread .detail .body{ position:relative; }
.post-thread .detail .body::before{
  content:""; position:absolute; left:-16px; top:44px; bottom:10px; width:2px; background:var(--line);
}
.post-thread .pics img{ max-width:100%; border-radius:12px; margin-top:10px; }
.post-thread .actions{ display:flex; gap:22px; margin-top:10px; color:var(--muted); }
.post-thread .action{ cursor:pointer; display:inline-flex; align-items:center; gap:6px; }
.post-thread .action.like.liked{ color:#e0245e; }

/* timestamp row under the post */
.post-thread .meta-row{
  display:grid; grid-template-columns:56px 1fr; column-gap:12px;
  padding:12px 16px; border-top:1px solid var(--line); border-bottom:1px solid var(--line);
}
.post-thread .timestamp{ color:var(--muted); font-size:14px; }

/* =========================
   Inline reply composer (bottom)
   ========================= */

/* 允许容器随 textarea 一起长高，不裁切；顶对齐从上往下增长 */
.post-thread .row,
.post-thread .row .body,
.reply-inline,
.reply-editor{
  height: auto;
  overflow: visible;
}
.post-thread .row.composer{ align-items: flex-start; }

/* 左侧头像 + 右侧编辑区 */
.reply-inline{
  display:flex;
  gap:12px;
  align-items:flex-start;           /* 顶对齐，整体从上往下长高 */
}
.reply-inline .avatar{
  width:44px; height:44px; border-radius:50%;
  background:#ddd; flex-shrink:0;
  align-self:flex-start;           /* 头像固定在顶部，不随多行居中 */
}

/* 编辑区布局 */
.reply-editor{ flex:1; display:flex; flex-direction:column; }

/* 无边框 textarea，由 JS 控高 */
.reply-editor textarea{
  display:block; width:100%;
  border:none; outline:none; background:transparent; color:var(--fg);
  box-sizing:border-box;
  font-size:16px; line-height:1.5;
  padding:12px 0;
  resize:none;
  overflow-y:hidden;
  height:auto; min-height:28px;
  transition:height .15s ease, padding .15s ease;
}
.reply-editor textarea::placeholder{
  color:var(--muted); opacity:.75; font-weight:600; font-size:16px; text-align:left;
}
.reply-editor:focus-within textarea{
  min-height:64px; padding:14px 0;  /* 这段保留用于其他页面的编辑区 */
}

/* —— 针对帖子页回复框：首行高度=头像高度，初始中线对齐；聚焦不跳 —— */
#commentTextPage{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  font-size: 20px;                 /* 推特风：15/20 */
  line-height: 20px;
  padding: 12px 0;                 /* 12 + 20 + 12 = 44 */
  min-height: 44px;                /* 首行总高度与头像一致 */
  border: none; outline:none; background:transparent;
  color: var(--fg); resize:none; width:100%; box-sizing:border-box;
}
#commentTextPage::placeholder{
  font: inherit;                    /* 继承度量，避免下沉 */
  line-height: inherit;
  color: rgba(83,100,113,.9);
  font-weight: 500;
}
/* 聚焦时保持同一盒模型，防止“轻微下跳” */
.reply-editor:focus-within #commentTextPage{
  min-height: 44px;
  padding: 12px 0;
}

/* 工具栏（计数 + 按钮） */
.reply-inline .btn{
  display:inline-flex; align-items:center; justify-content:center;
  height:40px; padding:0 14px; border-radius:999px; font-weight:600;
}
.reply-tools{
  display:flex; align-items:center; justify-content:flex-end;
  gap:8px; padding-top:8px;
}
.char-counter{
  min-width:28px; height:28px; padding:0 8px; border-radius:999px;
  display:flex; align-items:center; justify-content:center;
  background:#f0f3f4; color:#606a73; font-weight:700; font-size:13px;
}
:root.dark .char-counter{ background:#1b1e20; color:#8b98a5; }
.char-counter.over{ background:#ffe8e8; color:#c81e1e; }
:root.dark .char-counter.over{ background:#3a0d0d; color:#ff7373; }

/* =========================
   Toast
   ========================= */
.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom:24px; background:var(--fg); color:var(--bg);
  padding:10px 14px; border-radius:12px; font-weight:600;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

/* =========================
   Responsive
   ========================= */
@media (max-width:1200px){
  .right-rail{ display:none; }
  .app{ grid-template-columns:72px minmax(0,680px); }
  .brand h1{ display:none; }
  .nav-item span{ display:none; }
  .btn-full{ display:none; }
  .me-block{ display:none; }
}
@media (max-width:680px){
  .left-nav{ display:none; }
  .app{ grid-template-columns:1fr; }
  .main{ border-right:none; }
  .right-rail{ display:none; }
  .topbar{ position:sticky; top:0; }
}

/* ===== Reply Modal: softer shadow + layout ===== */
.modal{ border:none; background: rgba(0,0,0,.50); }
.modal{ border:none; background: transparent; padding:0; }
.modal::backdrop{ background: rgba(0,0,0,.35); }

.reply-card{
  width:min(680px,96vw);
  background:var(--bg);
  color:var(--fg);
  border:none; outline:none; border-radius:16px; padding:0; position:relative;
  box-shadow:
    0 32px 96px -12px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0px rgba(0,0,0,.15);
}
:root.dark .reply-card{ outline:none; }
.reply-card .close{ position:absolute; top:10px; right:10px; }

dialog,
dialog:focus,
dialog:focus-visible,
.reply-card:focus,
.reply-card:focus-visible {
  outline: none !important;
  box-shadow: none;
}
dialog.modal {
  background: transparent !important;
  border: none !important;
  padding: 0;
  box-shadow: none !important;
}
.reply-card {
  border: none;
  outline: none;
  border-radius: 16px;
  background: var(--bg);
  color: var(--fg);
  box-shadow:
    0 32px 96px -16px rgba(0,0,0,.45),
    0 12px 28px -12px rgba(0,0,0,.30),
    0  2px  8px   0   rgba(0,0,0,.15);
}
dialog {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  background: transparent !important;
}

/* ===== Hotfix: 保证 Upsell 只在超字数时显示 ===== */
.upsell{ 
  display: none !important;
  visibility: hidden !important;
}
.upsell.show{
  display: block !important;
  visibility: visible !important;
}

/* ===== Hotfix: 输入框与头像精确对齐，并允许所在行随内容增高 ===== */
/* 保留 page 内通用的 editor 规则（非弹窗专属） */
#commentTextPage{
  font-size: 20px !important;
  line-height: 20px !important;
  padding: 12px 0 !important;   /* 12 + 20 + 12 = 44，与 44px 头像中心线对齐 */
  min-height: 44px !important;
}
.reply-editor:focus-within textarea{
  min-height: 44px !important;
  padding: 12px 0 !important;   /* 聚焦不跳动 */
}
/* 容器允许增长，不裁切 */
.post-thread .row,
.post-thread .row .body,
.reply-inline,
.reply-editor{
  height: auto !important;
  overflow: visible !important;
}

/* ===== 输入区：和外层版式一致（通用） ===== */
.reply-editor textarea{
  font-size: 20px; 
  line-height: 1.6;     /* 与正文统一 */
  padding: 12px 0;      /* 聚焦/未聚焦一致，避免跳动 */
  min-height: 44px;     /* 首行总高与 44px 头像匹配 */
}
.reply-editor textarea::placeholder{
  color: rgba(83,100,113,.9);
  font-weight: 400;
}

/* ===== 卡片正文折叠 / Show more ===== */
/* 卡片正文：基础 */
.card .text{
  font-size: 15px;
  line-height: 1.6;
  /* 关键：让行内换行按普通段落来，否则 -webkit-line-clamp 失效 */
  white-space: normal;           /* 覆盖 pre-wrap 才能正确夹行 */
  word-break: break-word;
  overflow-wrap: anywhere;
  position: relative;            /* 方便做渐隐层 */
}

/* 被夹时（5 行） */
.card .text.clamped{
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 5;         /* 5 行 */
  overflow: hidden;
}

/* Show more 样式（默认隐藏，JS 决定显示） */
.show-more{
  display:none;
  cursor:pointer;
  color:var(--primary);
  font-weight:600;
  margin-top:4px;
  z-index:2;                     /* 比卡片 hover 更高 */
  position: relative;            /* 让 z-index 生效 */
  text-decoration: none;         /* 默认不带下划线 */
}
.show-more:hover,
.show-more:focus-visible {       /* 鼠标悬停 & 键盘聚焦都显示下划线 */
  text-decoration: underline;
}




/* ========== 评论弹窗（别改了本来就全是bug） ========== */

/* Reply Modal 的可见性必须跟 open 属性走 */
#replyDialog{
  border: none;
  background: transparent;
  padding: 0;
  /* 千万不要在这里写 display:grid */
  z-index: 9999; /* 确保浮在最上层 */
}
/* 打开时才参与布局并居中 */
#replyDialog[open]{
  display: grid;
  place-items: center;
}
/* 关闭时强制隐藏，避免被其它样式意外覆盖 */
#replyDialog:not([open]){
  display: none !important;
}

#replyDialog::backdrop{
  background: rgba(0,0,0,.35);    /* 不要高斯模糊，仅半透明遮罩 */
}

/* 2) 外层容器（可选保留，已去掉任何阴影/滤镜） */
.mf-shadow{
  display: block;
  max-width: 96vw;
  margin: 0 auto;                 /* 不做投影，仅保持结构 */
}

/* 3) 弹窗卡片主体（无阴影） */
.mf-modal-card{
  width: min(600px, 96vw);
  border-radius: 16px;
  background: var(--bg);
  color: var(--fg);
  overflow: hidden;               /* 只裁内容，圆角可见 */
  border: 1px solid color-mix(in srgb, var(--fg) 6%, transparent);
  margin: 0 16px;                 /* 仅左右留点安全边距；不增加顶部空白 */
}

/* 顶栏 */
.mf-modal-topbar{
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 14px;
  border-bottom: 1px solid var(--line);
  color: var(--muted);
}
.mf-modal-close{
  border: none; background: transparent; cursor: pointer;
  padding: 6px; border-radius: 8px; color: var(--muted);
}
.mf-modal-close:hover{ background: var(--hover); }

/* 内容区整体内边距（避免文字靠右贴边） */
/* 内容区：把上 padding 收紧 */
.mf-modal-body{
  padding: 12px 20px 16px;   /* 原来是 16px 20px，少 4px 就贴近顶栏了 */
}

/* 任何可能的“首行外边距”一律清零 */
.mf-modal-body > *:first-child{ margin-top: 0; }
.mf-thread{ margin-top: 0; }
.mf-quote .head{ margin: 0; }     /* 标题行 */
.mf-quote .text{ margin-top: 4px; }  /* 正文与标题的间距保留一点点即可 */


/* ========== 两列线程：双头像 + 连接灰线 ========== */
.mf-thread{
  display: grid;
  grid-template-columns: 56px 1fr;
  column-gap: 14px;
  row-gap: 16px;
  align-items: start;
}
.mf-thread .body{
  grid-column: 2;
  padding-right: 8px;             /* 再给右侧一点安全内边距 */
}

/* 左侧头像栏 */
.mf-rail{
  grid-column: 1;
  position: relative;
  display: flex; justify-content: center; align-items: flex-start;
}
.mf-rail .avatar{
  width: 40px; height: 40px; border-radius: 50%;
  background: #ddd; object-fit: cover;
}

/* ========== 引用区（原作者文本）：5 行 clamp + Show more ========== */
.mf-quote .head{
  font-weight: 700; font-size: 15px;
  display: flex; gap: 6px; align-items: flex-start;
}
.mf-quote .meta{ color: var(--muted); font-weight: 400; }

.mf-quote .text{
  font-size: 15px; line-height: 1.6; margin: 0;
  white-space: pre-wrap;          /* 保留空行/换行 */
  word-break: break-word;
  overflow-wrap: anywhere;
  position: relative;
}
.mf-quote .text.clamped{
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 5;          /* 仅显示 5 行 */
  overflow: hidden;
}

/* Show more（仅在被夹时显示；悬停下划线） */
.show-more{
  display: none; cursor: pointer; color: var(--primary);
  font-weight: 600; margin-top: 6px;
  position: relative; z-index: 3;
  text-decoration: none;
}
.mf-quote .text.clamped + .show-more{ display: inline; }
.show-more:hover,
.show-more:focus-visible{ text-decoration: underline; }

/* ========== 编辑器（与主页风格统一） ========== */
.mf-editor{ display: flex; flex-direction: column; gap: 8px; }

/* Reply 弹窗输入框：与正文下方一致（20/20，首行 44px） */
#replyDialog .mf-input{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  font-size: 20px;
  line-height: 20px;
  padding: 12px 0;     /* 12 + 20 + 12 = 44 */
  min-height: 44px;

  border: none;
  outline: none;
  background: transparent;
  color: var(--fg);
  resize: none;
  width: 100%;
  box-sizing: border-box;
  overflow: hidden;
}

#replyDialog .mf-input::placeholder{
  font: inherit;          /* 继承 20/20 */
  line-height: inherit;
  color: rgba(83,100,113,.9);
  font-weight: 500;
}

/* 聚焦不跳动（保持同一盒模型） */
#replyDialog .mf-editor:focus-within .mf-input{
  min-height: 44px;
  padding: 12px 0;
}

.mf-tools{
  display: flex; align-items: center; justify-content: flex-end; gap: 8px;
}
.mf-counter{
  min-width: 28px; height: 28px; padding: 0 8px; border-radius: 999px;
  display: flex; align-items: center; justify-content: center;
  background: #f0f3f4; color: #606a73; font-weight: 700; font-size: 13px;
}
:root.dark .mf-counter{ background: #1b1e20; color: #8b98a5; }
.mf-counter.over{ background: #ffe8e8; color: #c81e1e; }
:root.dark .mf-counter.over{ background: #3a0d0d; color: #ff7373; }

.mf-btn{
  border: 1px solid var(--line); background: var(--card); color: var(--fg);
  padding: 8px 14px; border-radius: 999px; cursor: pointer; font-weight: 700;
}
.mf-btn:hover{ background: var(--hover); }
.mf-btn.primary{
  background: var(--primary); color: var(--primary-ink); border-color: var(--primary);
}
.mf-btn.primary:hover{ filter: brightness(1.03); }

/* 小屏边距微调（可选） */
@media (max-width: 680px){
  .mf-modal-card{ margin: 0 12px; }
  .mf-modal-body{ padding: 14px 16px; }
}

/* 让容器成为定位上下文 */
.mf-thread{ position: relative; }

/* 绝对定位的“脊柱”灰线——由 JS 设置 top/height/left */
.mf-spine{
  position: absolute;
  width: 2px;
  background: var(--line);
  border-radius: 1px;
  /* 下面这些由 JS 动态设置：
     left: <头像中线>;
     top:  <上头像底 8px>;
     height: <直到下头像上方 12px>;
  */
}




/* ==================== 转发和引用卡片 ==================== */
/* ===== 选择 & 引用弹窗 ===== */
#repostChoiceDialog,#quoteDialog{ border:none;background:transparent;padding:0; }
#repostChoiceDialog[open],#quoteDialog[open]{ display:grid; place-items:center; }
#repostChoiceDialog:not([open]),#quoteDialog:not([open]){ display:none!important; }
#repostChoiceDialog::backdrop,#quoteDialog::backdrop{ background: rgba(0,0,0,.35); }

/* ===== “转发了”徽标 ===== */
.repost-badge{ color:var(--muted); font-size:12px; margin:0 0 4px 52px; display:flex; align-items:center; gap:6px; }
.repost-badge .icon{ transform:translateY(-1px); }

/* ===== 文本行高统一（父卡 + 引用卡） ===== */
:root { --post-lh: 1.6; }
.card .text,
.quote-embed .q-text{
  line-height: var(--post-lh);
  white-space: normal;      /* 已将 \n -> <br>，不需要 pre-wrap */
  margin: 0;
}
.quote-embed .q-text br{ line-height: inherit; }
.quote-embed .q-text.clamped{
  display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:5; overflow:hidden;
}

/* ===== 引用卡（推特风：左头像 + 右正文） ===== */
.quote-embed{
  display:flex; align-items:flex-start; gap:8px;
  padding:10px; border-radius:12px;
  border:1px solid var(--line);
  background: var(--card);                    /* 默认白/深色卡片底 */
  transition: background-color .22s ease, box-shadow .22s ease;
}
.quote-embed > img.avatar{
  width:28px; height:28px; border-radius:50%; flex:0 0 28px; object-fit:cover;
}
.quote-embed .q-content{ flex:1; min-width:0; }
.quote-embed .q-head{ font-weight:600; font-size:14px; }
.quote-embed .q-head .meta{ margin-left:6px; color:var(--muted); font-weight:400; }
.quote-embed .show-more{ display:none; color:var(--primary); font-weight:600; cursor:pointer; margin-top:4px; }
.quote-embed .q-text.clamped + .show-more{ display:inline; }

/* ===== 父卡 hover：父卡浅灰、过渡更顺滑 ===== */
.card.clickable{ transition: background-color .22s ease; }
.card.clickable:hover{ background: var(--hover); }

/* ===== 引用卡 hover：在父卡 hover 时，引用卡略深一点（有 fallback） ===== */
.card.clickable:hover .quote-embed{ background: var(--card); } /* 父卡灰时，引用仍白底 */

@supports (background: color-mix(in srgb, black 10%, white)){
  /* 鼠标移到引用块本身：比父卡 hover 稍深，但不要太重 */
  .card.clickable:hover .quote-embed:hover{
    /* 以父卡 hover 为基，向前景色混 12% 得到微深的灰 */
    background: color-mix(in srgb, var(--hover) 96%, var(--fg) 4%);
  }
}
/* 不支持 color-mix 的浏览器：用极轻的内阴影模拟“更深一点” */
@supports not (background: color-mix(in srgb, black 10%, white)){
  .card.clickable:hover .quote-embed:hover{
    background: var(--hover);
    box-shadow: inset 0 0 0 999px rgba(0,0,0,.02);
  }
}

/* ===== 无障碍：若用户减少动效，则禁用过渡 ===== */
@media (prefers-reduced-motion: reduce){
  .card.clickable, .quote-embed{ transition: none !important; }
}

/* 父帖正文与引用卡的间距（更舒服一点） */
.card .text + .quote-embed{
  margin-top: 12px; /* 10→12 更接近图2手感 */
}

/* 引用卡：改用 grid 让“正文”从头像的左边缘开始（与头像左对齐） */
.quote-embed{
  /* 外观保持不变，只是把布局从 flex 换成 grid */
  display: grid;
  grid-template-columns: 28px 8px 1fr; /* 头像宽 28 + 间距 8 + 正文区 */
  grid-template-areas:
    "av  . head"
    "av  . text"
    "av  . more";
  align-items: start;

  padding: 12px;                /* 稍微更松一点 */
  border-radius: 12px;
  border: 1px solid var(--line);
  background: var(--card);
  transition: background-color .22s ease, box-shadow .22s ease;
}

.quote-embed > img.avatar{
  grid-area: av;
  width: 28px; height: 28px;
  border-radius: 50%;
  object-fit: cover;
}

.quote-embed .q-content{ min-width: 0; } /* 兼容旧结构，可留着 */

.quote-embed .q-head{
  grid-area: head;
  font-weight: 600; font-size: 14px;
  margin: 0 0 6px;               /* 用户名与正文之间留一点空间（图2手感） */
}
.quote-embed .q-head .meta{
  margin-left: 6px; color: var(--muted); font-weight: 400;
}

.quote-embed .q-text{
  grid-area: text;
  line-height: var(--post-lh);
  white-space: normal;
  margin: 0;                     /* 与 q-head 的 6px 间距由上面控制 */
}
.quote-embed .q-text.clamped{
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 5;
  overflow: hidden;
}
.quote-embed .q-text br{ line-height: inherit; }

.quote-embed .show-more{
  grid-area: more;
  display: none;
  color: var(--primary);
  font-weight: 600;
  cursor: pointer;
  margin-top: 6px;
}
.quote-embed .q-text.clamped + .show-more{ display: inline; }

/* 悬停层级与过渡（保持你之前的手感） */
.card.clickable{ transition: background-color .22s ease; }
.card.clickable:hover{ background: var(--hover); }
.card.clickable:hover .quote-embed{ background: var(--card); }
@supports (background: color-mix(in srgb, black 10%, white)){
  .card.clickable:hover .quote-embed:hover{
    background: color-mix(in srgb, var(--hover) 97%, var(--fg) 3%);
  }
}
@supports not (background: color-mix(in srgb, black 10%, white)){
  .card.clickable:hover .quote-embed:hover{
    background: var(--hover);
    box-shadow: inset 0 0 0 999px rgba(0,0,0,.015);
  }
}
@media (prefers-reduced-motion: reduce){
  .card.clickable, .quote-embed{ transition: none !important; }
}

/* 父帖正文与引用卡之间的距离（稍微更松） */
.card .text + .quote-embed{
  margin-top: 12px;
}

/* 引用卡：使用 grid，正文与头像左对齐 */
.quote-embed{
  display: grid;
  grid-template-columns: 28px 8px 1fr;           /* 头像 28 + 间距 8 + 正文 */
  grid-template-areas:
    "av  . head"
    "av  . text"
    "av  . more";
  align-items: start;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: var(--card);
  transition: background-color .22s ease, box-shadow .22s ease;
}

.quote-embed > img.avatar{
  grid-area: av;
  width: 28px; height: 28px;
  border-radius: 50%;
  object-fit: cover;
}

/* 关键：防止网格子项按 min-content 折成“一字一行” */
.quote-embed .q-head,
.quote-embed .q-text,
.quote-embed .show-more{ min-width: 0; }

.quote-embed .q-head{
  grid-area: head;
  font-weight: 600; font-size: 14px;
  margin: 0 0 6px;
}
.quote-embed .q-head .meta{
  margin-left: 6px; color: var(--muted); font-weight: 400;
}

.quote-embed .q-text{
  grid-area: text;
  line-height: var(--post-lh);
  white-space: normal;                 /* 不要 pre-wrap，\n 已被 <br> 处理 */
  overflow-wrap: anywhere;
  word-break: break-word;
  margin: 0;
}
.quote-embed .q-text.clamped{
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 5;
  overflow: hidden;
}
.quote-embed .q-text br{ line-height: inherit; }

.quote-embed .show-more{
  grid-area: more;
  display: none;
  color: var(--primary);
  font-weight: 600;
  cursor: pointer;
  margin-top: 6px;
}
.quote-embed .q-text.clamped + .show-more{ display: inline; }

/* 悬停层级（父卡浅灰；引用卡在其上轻微更深） */
.card.clickable{ transition: background-color .22s ease; }
.card.clickable:hover{ background: var(--hover); }
.card.clickable:hover .quote-embed{ background: var(--card); }

@supports (background: color-mix(in srgb, black 10%, white)){
  .card.clickable:hover .quote-embed:hover{
    background: color-mix(in srgb, var(--hover) 98%, var(--fg) 2%); /* 很淡的强调 */
  }
}
@supports not (background: color-mix(in srgb, black 10%, white)){
  .card.clickable:hover .quote-embed:hover{
    background: var(--hover);
    box-shadow: inset 0 0 0 999px rgba(0,0,0,.015);
  }
}

@media (prefers-reduced-motion: reduce){
  .card.clickable, .quote-embed{ transition: none !important; }
}
