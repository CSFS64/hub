<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>FreeLand</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" href="data:," />
</head>
<body>
  <div id="app" class="app">
    <!-- Left Nav -->
    <aside class="left-nav">
      <div class="brand">
        <svg viewBox="0 0 24 24" class="logo"><path d="M3 12c0-4.97 4.03-9 9-9 2.53 0 4.82 1.03 6.47 2.69L12 12l6.47 6.31A8.98 8.98 0 0 1 12 21c-4.97 0-9-4.03-9-9z"/></svg>
        <h1>FreeLand</h1>
      </div>
      <nav class="nav-items">
        <a data-link="home" class="nav-item is-active"><span>首页</span></a>
        <a data-link="following" class="nav-item"><span>关注</span></a>
        <a data-link="profile" class="nav-item"><span>我的</span></a>
        <a data-link="search" class="nav-item"><span>搜索</span></a>
        <a id="toggleTheme" class="nav-item"><span>深浅色</span></a>
      </nav>
      <button id="openComposer" class="btn btn-primary btn-full">发帖</button>
      <div class="me-block" id="meBlock"></div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="topbar">
        <div class="tabs">
          <button data-tab="for_you" class="tab is-active">推荐</button>
          <button data-tab="following" class="tab">关注</button>
        </div>
        <div class="searchbar" id="searchbar">
          <input id="q" type="search" placeholder="搜索帖子…" />
          <button id="btnSearch" class="icon-btn" title="搜索">🔍</button>
        </div>
      </header>

      <section id="composeInline" class="composer">
        <img class="avatar" id="meAvatar" alt="">
        <div class="composer-body">
          <textarea id="postText" rows="3" placeholder="有什么新鲜事？（最多 500 字）"></textarea>
          <div class="composer-actions">
            <label class="icon-btn">
              📷<input id="postImages" type="file" accept="image/*" multiple hidden>
            </label>
            <div class="preview" id="imgPreview"></div>
            <button id="btnPublish" class="btn btn-primary">发布</button>
          </div>
        </div>
      </section>

      <div id="feed" class="feed"></div>
      <div id="emptyHint" class="empty" hidden>这里还没有内容～</div>
      <div id="loading" class="loading" hidden>加载中…</div>
    </main>

    <!-- Right -->
    <aside class="right-rail">
      <div class="panel">
        <h3>建议关注</h3>
        <div id="suggestions" class="suggestions"></div>
      </div>
      <div class="panel">
        <h3>关于</h3>
        <p class="muted">一个超轻量的推特风迷你论坛。</p>
      </div>
    </aside>
  </div>

  <!-- Auth Modal -->
  <dialog id="authDialog" class="modal">
    <form method="dialog" class="modal-card auth-card" onsubmit="return false;">
      <button class="icon-btn close" onclick="$.closeAuth()">✖</button>
      <h2 id="authTitle">登录 / 注册</h2>

      <div class="tabs small">
        <button data-auth="phone" class="tab is-active">手机验证码</button>
        <button data-auth="password" class="tab">账号密码</button>
      </div>

      <div id="phonePane" class="pane">
        <label>手机号（E.164，如 +8613xxxxxxxxx）</label>
        <input id="phone" type="tel" placeholder="+8613xxxxxx" />
        <div class="row">
          <input id="otp" placeholder="验证码" />
          <button id="btnSendOtp" class="btn">发送验证码</button>
        </div>
        <label>昵称（注册时可填）</label>
        <input id="nickname" placeholder="你的昵称" />
        <div class="row">
          <button id="btnPhoneLogin" class="btn btn-primary btn-full">登录 / 注册</button>
        </div>
      </div>

      <div id="passPane" class="pane" hidden>
        <label>账号（用户名或手机号）</label>
        <input id="account" placeholder="用户名或手机号" />
        <label>密码</label>
        <input id="password" type="password" placeholder="密码" />
        <div class="row">
          <button id="btnPasswordLogin" class="btn btn-primary btn-full">账号密码登录</button>
        </div>
      </div>
    </form>
  </dialog>

  <dialog id="replyDialog">
    <div class="mf-shadow">
      <div class="mf-modal-card">
        <div class="mf-modal-topbar">
          <div>Reply</div>
          <button class="mf-modal-close" onclick="$.closeReply()">✕</button>
        </div>
  
        <div class="mf-modal-body">
          <!-- 两列线程布局 -->
          <div class="mf-thread">
            <!-- 上：原作者 rail + 文本 -->
            <div class="mf-rail">
              <img id="replyAuthorAvatar" class="avatar" alt="">
            </div>
            <div id="replyHost" class="mf-quote body"><!-- JS 填充原帖 --></div>

            <!-- 下：我自己的 rail + 编辑器 -->
            <div class="mf-rail me">
              <img id="replyMyAvatar" class="avatar" alt="">
            </div>
            <div class="mf-editor body">
              <textarea id="replyText" class="mf-input" rows="1" placeholder="Post your reply"></textarea>
              <div class="mf-tools">
                <div id="replyModalCounter" class="mf-counter">280</div>
                <button id="btnReply" class="mf-btn primary" type="button">Reply</button>
              </div>
              <div id="replyModalUpsell" class="upsell">
                Upgrade to <b>Premium+</b> to write longer posts and Articles.
                <a class="link" href="javascript:;">Learn more</a>
              </div>
            </div>
          </div>
          <!-- /mf-thread -->
        </div>
      </div>
    </div>
  </dialog>

  <!-- 选择：转发 or 引用 -->
  <dialog id="repostChoiceDialog">
    <div class="mf-modal-card" style="width:min(420px,96vw);margin:0 16px;border-radius:16px;background:var(--bg);color:var(--fg);border:1px solid color-mix(in srgb, var(--fg) 6%, transparent);">
      <div class="mf-modal-topbar">
        <div>转发</div>
        <button class="mf-modal-close" onclick="document.getElementById('repostChoiceDialog').close()">✕</button>
      </div>
      <div class="mf-modal-body" style="padding:16px 20px;">
        <button id="btnRepostNow" class="mf-btn" style="width:100%;margin-bottom:10px;">🔁 直接转发</button>
        <button id="btnQuote" class="mf-btn" style="width:100%;">📝 引用并评论</button>
      </div>
    </div>
  </dialog>
  
  <!-- 引用弹窗（新帖子 + 嵌入原帖预览） -->
  <dialog id="quoteDialog">
    <div class="mf-modal-card" style="width:min(600px,96vw);margin:0 16px;border-radius:16px;background:var(--bg);color:var(--fg);border:1px solid color-mix(in srgb, var(--fg) 6%, transparent);">
      <div class="mf-modal-topbar">
        <div>引用帖子</div>
        <button class="mf-modal-close" onclick="document.getElementById('quoteDialog').close()">✕</button>
      </div>
      <div class="mf-modal-body">
        <div class="mf-editor" style="margin-bottom:10px;">
          <textarea id="quoteText" class="mf-input" rows="2" placeholder="写点你的看法（可选）"></textarea>
          <div class="mf-tools">
            <div id="quoteCounter" class="mf-counter">280</div>
            <button id="btnQuoteSend" class="mf-btn primary">发布</button>
          </div>
        </div>
  
        <!-- 原帖预览（可点击跳原帖） -->
        <div id="quotePreview" class="quote-embed" role="button"></div>
      </div>
    </div>
  </dialog>

  <!-- Toast -->
  <div id="toast" class="toast" hidden></div>

  <!-- 全屏图片查看器 -->
  <div id="imgViewer" class="img-viewer" hidden>
    <button class="close" id="imgViewerClose" title="关闭">×</button>
    <button class="nav prev" id="imgViewerPrev" title="上一张">‹</button>
    <img id="imgViewerImg" alt="">
    <button class="nav next" id="imgViewerNext" title="下一张">›</button>
  </div>

  <script src="./main.js"></script>

  <script type="module">
    import { playLoader } from './loader.js';
    playLoader({
      // 这些默认值已经接近你截图的比例与间距
      brand: '#2da7ff',
      text: 'FreeLand',
      durSpin: 1200,
      durMerge: 600,
      shiftLeft: -20,   // 图标左移
      wordRight: 28,    // 文字相对图标的最终右侧距离
      // 可选：startDeg: -90  // 从上方开始扫
    });
  </script>
  
</body>
</html>
